{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"definitions": {
		"CommApiManagerJsonTable": {
			"allOf": [
				{
					"description": "服务管理器基础配置",
					"type": "object",
					"properties": {
						"max_resource": {
							"description": "最大允许资源量 未设置则视为无限",
							"type": "number"
						}
					}
				},
				{
					"type": "object",
					"properties": {
						"instance_table": {
							"type": "object",
							"additionalProperties": {
								"$ref": "#/definitions/ServiceConfig<{Telegram:(table:TelegramServiceData)=>TelegramApi;Discord:(table:DiscordServiceData)=>DiscordApi;OneBot:(table:OneBotServiceData)=>OneBotApi;KOOK:(table:KOOKServiceData)=>KOOKApi;}>"
							}
						}
					},
					"required": [
						"instance_table"
					]
				}
			]
		},
		"ServiceConfig<{Telegram:(table:TelegramServiceData)=>TelegramApi;Discord:(table:DiscordServiceData)=>DiscordApi;OneBot:(table:OneBotServiceData)=>OneBotApi;KOOK:(table:KOOKServiceData)=>KOOKApi;}>": {
			"description": "服务构造函数表所对应的单个服务的配置表\n将 类型:工厂函数 映射 转换为完整配置文件",
			"anyOf": [
				{
					"allOf": [
						{
							"description": "服务基础配置",
							"type": "object",
							"properties": {
								"name": {
									"description": "服务实例名",
									"type": "string"
								},
								"rollback": {
									"description": "此服务若失败则尝试回退的实例名",
									"type": "string"
								},
								"resource_usage": {
									"description": "此服务的资源占用量\n省略将视为0\n小于等于0时不会尝试卸载",
									"type": "number"
								}
							},
							"required": [
								"name"
							]
						},
						{
							"type": "object",
							"properties": {
								"type": {
									"$ref": "#/definitions/P",
									"description": "服务类型"
								},
								"data": {
									"$ref": "#/definitions/Opt",
									"description": "此实例的初始化数据"
								}
							},
							"required": [
								"data",
								"type"
							]
						}
					]
				},
				{
					"allOf": [
						{
							"description": "服务基础配置",
							"type": "object",
							"properties": {
								"name": {
									"description": "服务实例名",
									"type": "string"
								},
								"rollback": {
									"description": "此服务若失败则尝试回退的实例名",
									"type": "string"
								},
								"resource_usage": {
									"description": "此服务的资源占用量\n省略将视为0\n小于等于0时不会尝试卸载",
									"type": "number"
								}
							},
							"required": [
								"name"
							]
						},
						{
							"type": "object",
							"properties": {
								"type": {
									"$ref": "#/definitions/P_1",
									"description": "服务类型"
								},
								"data": {
									"$ref": "#/definitions/Opt_1",
									"description": "此实例的初始化数据"
								}
							},
							"required": [
								"data",
								"type"
							]
						}
					]
				},
				{
					"allOf": [
						{
							"description": "服务基础配置",
							"type": "object",
							"properties": {
								"name": {
									"description": "服务实例名",
									"type": "string"
								},
								"rollback": {
									"description": "此服务若失败则尝试回退的实例名",
									"type": "string"
								},
								"resource_usage": {
									"description": "此服务的资源占用量\n省略将视为0\n小于等于0时不会尝试卸载",
									"type": "number"
								}
							},
							"required": [
								"name"
							]
						},
						{
							"type": "object",
							"properties": {
								"type": {
									"$ref": "#/definitions/P_2",
									"description": "服务类型"
								},
								"data": {
									"$ref": "#/definitions/Opt_2",
									"description": "此实例的初始化数据"
								}
							},
							"required": [
								"data",
								"type"
							]
						}
					]
				},
				{
					"allOf": [
						{
							"description": "服务基础配置",
							"type": "object",
							"properties": {
								"name": {
									"description": "服务实例名",
									"type": "string"
								},
								"rollback": {
									"description": "此服务若失败则尝试回退的实例名",
									"type": "string"
								},
								"resource_usage": {
									"description": "此服务的资源占用量\n省略将视为0\n小于等于0时不会尝试卸载",
									"type": "number"
								}
							},
							"required": [
								"name"
							]
						},
						{
							"type": "object",
							"properties": {
								"type": {
									"$ref": "#/definitions/P_3",
									"description": "服务类型"
								},
								"data": {
									"$ref": "#/definitions/Opt_3",
									"description": "此实例的初始化数据"
								}
							},
							"required": [
								"data",
								"type"
							]
						}
					]
				}
			]
		},
		"P": {
			"type": "string",
			"const": "Telegram"
		},
		"__type": {
			"description": "Telegram初始化选项",
			"type": "object",
			"properties": {
				"charname": {
					"description": "绑定角色名",
					"type": "string"
				},
				"token": {
					"description": "登录token",
					"type": "string"
				},
				"uid": {
					"description": "用户uid",
					"type": "string"
				},
				"proxy_url": {
					"description": "正向代理链接",
					"type": "string"
				}
			},
			"required": [
				"charname",
				"token",
				"uid"
			]
		},
		"Opt": {
			"$ref": "#/definitions/__type"
		},
		"P_1": {
			"type": "string",
			"const": "Discord"
		},
		"__type_1": {
			"description": "Discord初始化选项",
			"type": "object",
			"properties": {
				"charname": {
					"description": "绑定角色名",
					"type": "string"
				},
				"token": {
					"description": "登录token",
					"type": "string"
				},
				"proxy_url": {
					"description": "正向代理链接",
					"type": "string"
				}
			},
			"required": [
				"charname",
				"token"
			]
		},
		"Opt_1": {
			"$ref": "#/definitions/__type_1"
		},
		"P_2": {
			"type": "string",
			"const": "OneBot"
		},
		"__type_2": {
			"description": "OneBot初始化选项",
			"type": "object",
			"properties": {
				"charname": {
					"description": "绑定角色名",
					"type": "string"
				},
				"listen_port": {
					"description": "监听端口",
					"type": "number"
				},
				"send_port": {
					"description": "发信端口",
					"type": "number"
				},
				"subtype": {
					"$ref": "#/definitions/Subtype",
					"description": "子类型"
				},
				"self_id": {
					"description": "自身的user_id 用于避免消息回环 在共用listener时判断消息发送目标",
					"type": "string"
				},
				"without_at": {
					"description": "在群消息时无需at也会响应 默认 false",
					"type": "boolean"
				}
			},
			"required": [
				"charname",
				"listen_port",
				"self_id",
				"send_port",
				"subtype"
			]
		},
		"Subtype": {
			"enum": [
				"kook",
				"qq",
				"qq_official"
			],
			"type": "string"
		},
		"Opt_2": {
			"$ref": "#/definitions/__type_2"
		},
		"P_3": {
			"type": "string",
			"const": "KOOK"
		},
		"__type_3": {
			"description": "KOOK初始化选项",
			"type": "object",
			"properties": {
				"charname": {
					"description": "绑定角色名",
					"type": "string"
				},
				"token": {
					"description": "登录token",
					"type": "string"
				},
				"self_id": {
					"description": "自身id",
					"type": "string"
				}
			},
			"required": [
				"charname",
				"self_id",
				"token"
			]
		},
		"Opt_3": {
			"$ref": "#/definitions/__type_3"
		}
	}
}